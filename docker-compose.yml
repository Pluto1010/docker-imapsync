version: '2'

services:
  imapsync:
    hostname: imapsync
    build: ./imapsync
    links:
      - "mail"
  mail:
    image: tvial/docker-mailserver:v2
    hostname: mail
    domainname: imapsync.local
    ports:
      #- "25:25"
      - "143:143"
      - "587:587"
      - "993:993"
    volumes:
      - maildata:/var/mail
      - ./config/:/tmp/docker-mailserver/
    environment:
      - ENABLE_FAIL2BAN=1
    cap_add:
      - NET_ADMIN
  nginx:
    image: nginx:1.11-alpine
    hostname: web
    ports:
      - "8080:80"
    volumes:
      - ./nginx-site.conf:/etc/nginx/conf.d/default.conf
    volumes_from:
      - data
    links:
      - "php"
      - "mail"
  php:
    hostname: php
    image: php:5.6-fpm-alpine
    volumes_from:
      - data
    environment:
      - ENCRYPTION_KEY=609dd9ac1b784a6787312bd6
  data:
    build:
      context: roundcube
    volumes:
      - /web
      - /rc

volumes:
  maildata:
    driver: local
