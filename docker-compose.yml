version: '2'

services:
  imapsync:
    hostname: imapsync
    build:
      context: imapsync
    links:
      - "mail"
  mail:
    hostname: mail
    domainname: imapsync.local
    build:
      context: mailsrv
    ports:
      #- "25:25"
      - "143:143"
      - "587:587"
      - "993:993"
    volumes:
      - maildata:/var/mail
      - mailconfig:/tmp/docker-mailserver/
    environment:
      - ENABLE_FAIL2BAN=1
    cap_add:
      - NET_ADMIN
  nginx:
    hostname: web
    build:
      context: nginx
    ports:
      - "8080:80"
    volumes_from:
      - data
    links:
      - "php"
      - "mail"
  php:
    hostname: php
    image: php:5.6-fpm-alpine
    volumes_from:
      - data
    environment:
      - ENCRYPTION_KEY=609dd9ac1b784a6787312bd6
  data:
    build:
      context: roundcube
    volumes:
      - /web
      - /rc

volumes:
  maildata:
    driver: local
  mailconfig:
    driver: local
